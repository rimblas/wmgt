---
# ====== Page: View Weekly Results ===========================
id: 60
identification: 
  name: View Weekly Results
  alias: VIEW-RESULTS
  title: View Weekly Results

appearance: 
  page-mode: Normal
  page-template: Theme Default
  template-options: 
  - '#DEFAULT#'

navigation-menu: 
  override-user-interface-level: false

navigation: 
  cursor-focus: Do not focus cursor
  warn-on-unsaved-changes: false

javascript: 
  file-urls: 
  - //cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js
  - //cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js
  - null
  function-and-global-variable-declaration: |
    var selectedRank,selectedRankClass;
    function confetti_time() {
        confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 }
        });
    }
    function badgeMenuAction(btn, actionMenu, badge, player) {
     apex.server.process('BADGES'
        , {x01: actionMenu.label.split(' ')[0],
           x02: player,
           x03: badge,
           pageItems: '#P60_TOURNAMENT_SESSION_ID,#P60_BADGE_ID'
          }
        , {
            beforeSend: function(btn) {
              $(btn).parents("tr").find("[headers='BADGES']").append('<span aria-hidden="true" class="fa fa-spinner fa-anim-spin"></span>');
            },
            success: function( pData ) {
                var $cell = $(btn).parents("tr").find("[headers='BADGES']");
                if (pData.status === "ADDED") {
                  $cell.append('<i class="em ' + actionMenu.icon + '" aria-role="presentation" aria-label="' + actionMenu.icon + '"></i>');
                  addBadge($(btn), badge);
                  apex.message.showPageSuccess( badge + " badge added!" );
                  try {
                      $s("P60_BADGE_ID", pData.id);
                  } catch(err) {
                      $s("P60_BADGE_ID","")
                  }
    
                }
                else {
                    $cell.find("i." + actionMenu.icon).remove();
                }            
                $cell.find(".fa-spinner").remove();
            }
        }
     );
    }
    
    function hasBadge(btn$, badge) {
      let badge_json = btn$.data("badges");
      // console.log("hasBadge", badge_json);
      return badge_json.hasOwnProperty(badge);
    }
    
    function hasIssue(btn$) {
      let issue = btn$.data("issue");
      return !!issue;
    }
    
    function addBadge(btn$, badge) {
      let badge_json = btn$.data("badges");
      badge_json[badge] = 'true';
    //  console.log(badge_json);
    //  console.log(JSON.stringify(badge_json));
    //  btn$.data("badges", JSON.stringify(badge_json));
      btn$.data("badges", badge_json);
    }
    
  execute-when-page-loads: |
    var menu$ = $("<div id='badge_list_menu'></div>");
    $("body").append(menu$);
    wmgt.theme.init();
    menu$.menu({
      iconType: "em",
      items: [
        {
          type: "action",
          label: "Add Duck",
          icon: "em-duck",
          action: function(menu, btn) {
            badgeMenuAction(btn, this, 'DUCK', btn.dataset.id);
          },
          hide: function () {
              return true; // ducks are now automated. 
              var btn$ = $("button.is-active.js-menuButton");
              return hasIssue(btn$);
          }
        },
        {
          type: "action",
          label: "Add Beetle",
          icon: "em-beetle",
          action: function(menu, btn) {
            badgeMenuAction(btn, this, 'BEETLE', btn.dataset.id);
          },
          hide: function () {
              return true; // beetles are now automated. -- TODO jrimblas: remove!
              var btn$ = $("button.is-active.js-menuButton");
              return hasIssue(btn$);
          }
        },
        {
          type: "action",
          label: "Undo",
          icon: "fa fa-undo-arrow",
          action: function(menu, btn) {
            // console.log("Adding", button$.data("id"));
            // console.log(this);
            badgeMenuAction(btn, this, 'DIAMOND', btn.dataset.id);
          },
          hide: function () {
              // var btn$ = $("button.is-active.js-menuButton");
              return true;
              return !!!$v("P60_BADGE_ID");
          }
        },
        {
          type: "action",
          label: "Edit",
          icon: "fa fa-pencil",
          action: function(menu, btn) {
            // open dialog page 3 for the specific department
            // the dialog url including checksum is in the data-link attribute 
            // on the button that opens the menu
            var link,
            button$ = $(btn);
            // get the link and unescape unicode chars
            link = button$.attr("data-link").replace(/\\u(\d\d\d\d)/g, function(m,d) {
              return String.fromCharCode(parseInt(d, 16));
            });
            // console.log({link});
            apex.navigation.redirect(link);
          },
          hide: function () {
              var btn$ = $("button.is-active.js-menuButton");
              return hasIssue(btn$);
          }
        },
        {
          type: "action",
          label: "Not eligible",
          icon: "fa fa-times",
          action: function(menu, btn) {
            // nothing to do
            
          },
          hide: function () {
              var btn$ = $("button.is-active.js-menuButton");
              return !hasIssue(btn$);
          }
        }
      ]
    });

css: 
  file-urls: 
  - '&G_APP_FILES.css/week-lov#MIN#.css'
  - //emoji-css.afeld.me/emoji.css
  inline: |
    td.t-Report-cell[headers="PLAYER_NAME"] a {
    display: flex;
    flex-wrap: nowrap!important;
    }
    
    .-wm-player-name,
    td.t-Report-cell[headers="PLAYER_NAME"]{
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    td.t-Report-cell[headers="PLAYER_NAME"]{
        max-width: 160px;
    }
    .-wm-player-name {
        max-width: 140px;
        display: inline-block;
    }
    
    @media (max-width: 640px) {
    
        :root {
            --ut-report-cell-padding-y:.2rem;
            --ut-report-cell-padding-x:.4rem;
    
        }
    
        td[headers="AVATAR"],
        th#AVATAR {display: none;}
    
        td.t-Report-cell[headers="PLAYER_NAME"] {
            max-width: 140px;
            min-width: 140px;
        }
        .-wm-player-name {
            max-width: 114px;
        }
    
       .wm-search-item:first-child {
         width: 100%;
       }
       .wm-search-item {
        width: 50%;
       }
    
    }
    
    .hide_nav_next .t-Form-itemText--post {display: none;}
    .hide_nav_pre .t-Form-itemText--pre {display: none;}
    
    #weekResults, #weekResults2 {
        --ut-report-cell-padding-y: .35rem;
        --ut-report-cell-alt-background-color: #dadada;
    }
    #raceRegion {
        --ut-report-cell-padding-y: .35rem;
    }
    
    @media (max-width: 639px) {
      #POS, #EASY, #HARD, #TOTAL_SCORE, #POINTS, td[headers="POS"],
      td.t-Report-cell
       {
           --ut-report-cell-padding-x: .3rem;
           --ut-report-header-cell-padding-x: .2rem;
      }
      #COUNTRY_CODE, td[headers="COUNTRY_CODE"] {
           --ut-report-cell-padding-x: .4rem;
           --ut-report-header-cell-padding-x: .1rem;
      }
    }
    
    tr.podium td {
        --ut-report-cell-padding-y: .7rem;
        --ut-report-cell-background-color: hsl(45.59deg 100% 73%);
    }
    tr.podium.podium2 td {
        --ut-report-cell-background-color: #d4d4d4
    }
    tr.podium.podium3 td {
        --ut-report-cell-background-color: #e4b281
    }
    
    .w {
        display: inline-block;
        float: right;
    }
    
    span.points {
        font-weight: 700;
    }
    td.top {
        background-color: var(--rw-palette-ocean-120);
        color: var(--rw-palette-ocean-10);
    }
    .p10 {
        background-color: var(--rw-palette-ocean-110);
        color: var(--rw-palette-ocean-10);
    }
    .p9 {
        background-color: var(--rw-palette-ocean-100);
        color: var(--rw-palette-ocean-10);
    }
    .p8 {
        background-color: var(--rw-palette-ocean-90);
        color: var(--rw-palette-ocean-10);
    }
    .p7 {
        background-color: var(--rw-palette-ocean-80);
        color: var(--rw-palette-ocean-30);
    }
    .p6 {
        background-color: var(--rw-palette-ocean-70);
        color: var(--rw-palette-ocean-140);
    }
    .p5 {
        background-color: var(--rw-palette-ocean-60);
        color: var(--rw-palette-ocean-140);
    }
    .p4 {
        background-color: var(--rw-palette-ocean-50);
        color: var(--rw-palette-ocean-140);
    }
    .p3 {
        background-color: var(--rw-palette-ocean-40);
        color: var(--rw-palette-ocean-140);
    }
    .points.p2 {
        background-color: var(--rw-palette-ocean-30);
        color: var(--rw-palette-ocean-140);
    }
    .points.p1 {
        background-color: var(--rw-palette-ocean-20);
        color: var(--rw-palette-ocean-140);
    }
    .points.p0 {
        color: red;
    }
    
    .points.missing {
        text-decoration: line-through;
        color: #e05252;
        font-weight: normal;
        cursor: help;
    }
    
    .&P60_WEEK. {
        background-color: rgb(79, 79, 189);
        color: white;
        font-weight: bold;
    }
    
    .&P60_WEEK..discardY {
        color: #bfbfbf;
        font-weight: normal;
    }
    
    .t-Report--altRowsDefault .t-Report-report tr.mark:nth-child(odd) {
        --ut-report-cell-background-color: #ff0;
        color: #000;
    }
    
    #itemsRegion {
      flex-direction: row;
      display: flex;
      flex-wrap: wrap;
      width: 100%;
      background-color:  var(--ut-region-header-background-color,var(--ut-region-background-color,var(--ut-component-background-color)))
    }
    
    .searchLabel,
    #RANK_POS,
    #TEAM_NAME,
    td[headers="RANK_POS"],
    td[headers="TEAM_NAME"] {display:none;}
    
    .search-on .searchLabel  {display:inline-block;}
    
    .search-on:not(.cga) #RANK_POS,
    .search-on:not(.cga) td[headers="RANK_POS"] {display:table-cell;}
    
    .search-on.cga #TEAM_NAME,
    .search-on.cga td[headers="TEAM_NAME"] {display:table-cell;}
    
    
    #weekResults2 td[headers="PLAYER_NAME"] {
        line-height: 36px;
    }
    
    .courseIcon {
    width: 240px;
    height: 240px;
    }
    
    .nextCourses .courseLink {
            box-shadow: var(--ut-cardlist-box-shadow,var(--ut-component-box-shadow));
    }
    .nextCourses .course {
        transition: transform .2s ease;
    }
    .nextCourses .course:hover {
        transform: translateY(-0.5rem);
    }
    .nextCourses .course a {
        color: var(--ut-component-text-title-color);
    }
    
    
    .nextCourses {text-align: center;}
    .nextCourses .name {font-weight: 700; font-size: 1.1em;}
    .nextCourses .info.TBD {display: none;}
    
    #nextTournamentBrief .nextCourses .when {text-align: start;}
    #nextTournamentBrief .nextCourses .who {text-align: center;}
    #nextTournamentBrief .nextCourses .what {text-align: end;}
    @media (max-width: 1024px) {
     #nextTournamentBrief .nextCourses .when {text-align: center;}
     #nextTournamentBrief .nextCourses .what {text-align: center;}
    }
    
    label>.cgabadge.fa {
        display: contents;
    }
    .cgabadge {
     display: inline-block;
    }
    .cgabadge {
        background-image: url("&BUCKET.cga.webp");
        background-size: cover;
        width: 22px;
        height: 22px;
        border-radius: 50%;
    }

security: 
  authentication: Page Is Public
  deep-linking: Application Default
  page-access-protection: Unrestricted
  form-auto-complete: Off
  browser-cache: Application Default

session-management: 
  rejoin-sessions: Application Default

advanced: 
  enable-meta-tags: false
  enable-duplicate-page-submissions: Yes - Enable page to be re-posted
  reload-on-submit: Only for Success

server-cache: 
  caching: Disabled

help: 
  help-text: |
    Use the <i>View</i> toggle to focus on the <b>Week</b>ly Results or the <b>Season></b> race.<br>
    <br><br>
    
    The <b>Week Results</b> shows the placement of players and the points they will earn for the week.  
    Click on "About the Points" to understand how points are assigned.<br>
    <br><br>
    The <b>Season Race</b> shows the placement of players for the duration of the seasopm.<br> 
    The crossed out scores on the Season Race are the lowest score being discarded for a player. Every 3 weeks the lowest
    score is discarded, meaning the best 2 out of 3 scores is used. When you're unable to play that also counts as a low 
    score and will be considered as a discarded score. This way you can miss up to 4 weeks of the 12 week seasion and have
    the same opportunity.

regions: 
- # ====== Region: Breadcrumb Bar (Contrubutor) ================
  id: 8056243674938726
  identification: 
    name: Breadcrumb Bar (Contrubutor)
    type: Breadcrumb

  source: 
    breadcrumb: Breadcrumb # 46995003987350514326

  layout: 
    sequence: 11
    parent-region: No Parent
    slot: REGION_POSITION_01
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Title Bar
    template-options: 
    - '#DEFAULT#'
    - t-BreadcrumbRegion--compactTitle
    - t-BreadcrumbRegion--useBreadcrumbTitle
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  security: 
    authorization-scheme: Contribution Rights # 46995203801871514425

  customization: 
    customizable: Not Customizable By End Users

  comments: 
    comments: |
      This breadcrumb contains the Contributor buttons to download and verify results.
      

  attributes: 
    appearance: 
      breadcrumb-template: Breadcrumb
      template-options: 
      - '#DEFAULT#'

- # ====== Region: {col1} ======================================
  id: 36324460593635102
  identification: 
    name: '{col1}'
    type: Static Content

  layout: 
    sequence: 25
    parent-region: No Parent
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Blank with Attributes
    template-options: 
    - '#DEFAULT#'
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: true
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: {col2} ======================================
  id: 44899432802786407
  identification: 
    name: '{col2}'
    type: Static Content

  layout: 
    sequence: 35
    parent-region: No Parent
    slot: BODY
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Blank with Attributes
    template-options: 
    - '#DEFAULT#'
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: true
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: Badge Key ===================================
  id: 58468395492411061
  identification: 
    name: Badge Key
    type: Classic Report

  source: 
    location: Local Database
    type: Table / View
    table-owner: Parsing Schema
    table-name: WMG_BADGE_TYPES
    include-rowid-column: false
    where-clause: selectable_ind = 'Y'

  order-by: 
    type: Static Value
    order-by-clause: DISPLAY_SEQ

  layout: 
    sequence: 10
    parent-region: '{col1}' # 36324460593635102
    slot: SUB_REGIONS
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Standard
    template-options: 
    - '#DEFAULT#'
    - t-Region--noBorder
    - js-headingLevel-3
    - t-Region--scrollBody
    - t-Form--slimPadding
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: badgeKey
    region-display-selector: false
    exclude-title-from-translation: false

  header-and-footer: 
    footer-text: '"BADGES_BY_STEVEN"'

  server-cache: 
    caching: Enabled
    cache-timeout: 2 weeks
    depends-on-item(s): 
    - APP_REQUEST_DATA_HASH

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    layout: 
      number-of-rows-type: Static Value
      number-of-rows: 15

    appearance: 
      template-type: Theme
      template: Standard
      template-options: 
      - '#DEFAULT#'
      - t-Report--stretch
      - t-Report--staticRowColors
      - t-Report--rowHighlightOff
      - t-Report--noBorders

    pagination: 
      type: No Pagination (Show All Rows)
      partial-page-refresh: true

    performance: 
      lazy-loading: false

    break-formatting: 
      break-columns: No Break

    advanced: 
      strip-html: false
      sort-nulls: Last

    heading: 
      type: None

    download: 
      csv-export-enabled: false

    printing: 
      enabled: false

  columns: 
  - # ====== Column: ID ==========================================
    id: 36338566534723039
    identification: 
      column-name: ID
      type: Hidden

    layout: 
      sequence: 10

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: CODE ========================================
    id: 36338933204723040
    identification: 
      column-name: CODE
      type: Hidden

    layout: 
      sequence: 20

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: NAME ========================================
    id: 36339359218723041
    identification: 
      column-name: NAME
      type: Plain Text

    heading: 
      heading: Badge
      alignment: center

    layout: 
      sequence: 30
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    column-formatting: 
      html-expression: '<i class="#ICON_CLASS#" title="#NAME#"></i> <b>#NAME#</b>: #DESCRIPTION#'

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: DISPLAY_SEQ =================================
    id: 36339759264723041
    identification: 
      column-name: DISPLAY_SEQ
      type: Hidden

    layout: 
      sequence: 40

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: DESCRIPTION =================================
    id: 36340119681723042
    identification: 
      column-name: DESCRIPTION
      type: Hidden

    layout: 
      sequence: 50

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: ICON_CLASS ==================================
    id: 36340551637723043
    identification: 
      column-name: ICON_CLASS
      type: Hidden

    layout: 
      sequence: 60

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: ACTIVE_IND ==================================
    id: 36340933127723043
    identification: 
      column-name: ACTIVE_IND
      type: Hidden

    layout: 
      sequence: 70

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: CREATED_ON ==================================
    id: 36341352262723044
    identification: 
      column-name: CREATED_ON
      type: Hidden

    layout: 
      sequence: 80

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: CREATED_BY ==================================
    id: 36341775000723045
    identification: 
      column-name: CREATED_BY
      type: Hidden

    layout: 
      sequence: 90

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: UPDATED_ON ==================================
    id: 36342166868723045
    identification: 
      column-name: UPDATED_ON
      type: Hidden

    layout: 
      sequence: 100

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: UPDATED_BY ==================================
    id: 36342553650723046
    identification: 
      column-name: UPDATED_BY
      type: Hidden

    layout: 
      sequence: 110

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

- # ====== Region: Most h1n Season &P60_TOURNAMENT. ============
  id: 24462985729664546600
  identification: 
    name: Most h1n Season &P60_TOURNAMENT.
    type: Classic Report

  source: 
    location: Local Database
    type: SQL Query
    sql-query: |
      select r.*, rank() over (order by r.hn1 desc) pos
      from (
          select substr(r.week,1,3) season
           , p.player_name
           , sum(r.score) hn1
        from wmg_rounds_unpivot_mv r
           , wmg_players_v p
           , wmg_courses c
      where r.player_id = p.id
      and c.id = r.course_id
      and r.score = 1
      and r.week in ( select week from wmg_tournament_sessions where tournament_id = :P60_TOURNAMENT_ID)
      group by substr(r.week,1,3)
             , p.player_name
      order by 3 desc
      ) r
      

  layout: 
    sequence: 20
    parent-region: Other Results # 108304672202837297718
    slot: SUB_REGIONS
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Standard
    template-options: 
    - '#DEFAULT#'
    - t-Region--scrollBody
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  server-cache: 
    caching: Disabled

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    layout: 
      number-of-rows-type: Static Value
      number-of-rows: 10

    appearance: 
      template-type: Theme
      template: Standard
      template-options: 
      - '#DEFAULT#'
      - t-Report--stretch
      - t-Report--altRowsDefault
      - t-Report--rowHighlight

    pagination: 
      type: Row Ranges X to Y (with next and previous links)
      display-position: Bottom - Right
      partial-page-refresh: true

    performance: 
      lazy-loading: false

    break-formatting: 
      break-columns: No Break

    advanced: 
      strip-html: false
      sort-nulls: Last

    heading: 
      type: Custom Headings

    download: 
      csv-export-enabled: false

    printing: 
      enabled: false

  columns: 
  - # ====== Column: SEASON ======================================
    id: 12083190597610346
    identification: 
      column-name: SEASON
      type: Plain Text

    heading: 
      heading: Season
      alignment: center

    layout: 
      sequence: 30
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: HN1 =========================================
    id: 12083928113610347
    identification: 
      column-name: HN1
      type: Plain Text

    heading: 
      heading: Hn1
      alignment: center

    layout: 
      sequence: 50
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: POS =========================================
    id: 12084342337610348
    identification: 
      column-name: POS
      type: Plain Text

    heading: 
      heading: Pos
      alignment: center

    layout: 
      sequence: 10
      column-alignment: center

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: true

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: PLAYER_NAME =================================
    id: 36327780599635135
    identification: 
      column-name: PLAYER_NAME
      type: Plain Text

    heading: 
      heading: Player Name
      alignment: center

    layout: 
      sequence: 40
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: true

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

- # ====== Region: Most h1n Over the last &P60_TOTAL_WEEKS. week
  id: 24462990776443619028
  identification: 
    name: Most h1n Over the last &P60_TOTAL_WEEKS. weeks
    type: Classic Report

  source: 
    location: Local Database
    type: SQL Query
    sql-query: |
      select r.*, rank() over (order by r.hn1 desc) pos
      from (
      select p.player_name
           , sum(r.score) hn1
        from wmg_rounds_unpivot_mv r
           , wmg_players_v p
           , wmg_courses_v c
      where r.player_id = p.id
      and c.course_id = r.course_id
      and r.score = 1
      -- r.week like 'S07%'
      group by p.player_name
      order by 2 desc
      ) r

  layout: 
    sequence: 20
    parent-region: Other Results # 108304672202837297718
    slot: SUB_REGIONS
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Standard
    template-options: 
    - '#DEFAULT#'
    - t-Region--scrollBody
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  server-cache: 
    caching: Disabled

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    layout: 
      number-of-rows-type: Static Value
      number-of-rows: 10

    appearance: 
      template-type: Theme
      template: Standard
      template-options: 
      - '#DEFAULT#'
      - t-Report--stretch
      - t-Report--altRowsDefault
      - t-Report--rowHighlight

    pagination: 
      type: Row Ranges X to Y (with next and previous links)
      display-position: Bottom - Right
      partial-page-refresh: true

    performance: 
      lazy-loading: false

    break-formatting: 
      break-columns: No Break

    advanced: 
      strip-html: false
      sort-nulls: Last

    heading: 
      type: Custom Headings

    download: 
      csv-export-enabled: false

    printing: 
      enabled: false

  columns: 
  - # ====== Column: HN1 =========================================
    id: 12088018349682761
    identification: 
      column-name: HN1
      type: Plain Text

    heading: 
      heading: Hn1
      alignment: center

    layout: 
      sequence: 30
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: POS =========================================
    id: 12088413171682761
    identification: 
      column-name: POS
      type: Plain Text

    heading: 
      heading: Pos
      alignment: center

    layout: 
      sequence: 10
      column-alignment: center

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: true

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: PLAYER_NAME =================================
    id: 36327804026635136
    identification: 
      column-name: PLAYER_NAME
      type: Plain Text

    heading: 
      heading: Player Name
      alignment: center

    layout: 
      sequence: 20
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: true

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

- # ====== Region: {About week &P60_WEEK.} =====================
  id: 24790742868226858754
  identification: 
    name: '{About week &P60_WEEK.}'
    type: Classic Report

  source: 
    location: Local Database
    type: SQL Query
    sql-query: |
      select s.session_date
           , s.easy_course_code, nvl(ec.name, 'TBD -') easy_course
           , nvl((select to_char(min(r.under_par)) from  wmg_rounds_v r where r.course_id = s.easy_course_id), 'TBD') easy_record
           , apex_page.get_url(p_page => 200, p_clear_cache => '200', p_items =>'P200_COURSE_ID,P200_TOURNAMENT_SESSION_ID', p_values => s.easy_course_id || ',' || s.tournament_session_id) easy_stats_url
           , s.hard_course_code, nvl(hc.name, 'TBD -') hard_course
           , nvl((select to_char(min(r.under_par)) from  wmg_rounds_v r where r.course_id = s.hard_course_id), 'TBD') hard_record
           , apex_page.get_url(p_page => 200,p_clear_cache => '200', p_items =>'P200_COURSE_ID,P200_TOURNAMENT_SESSION_ID', p_values => s.hard_course_id || ',' || s.tournament_session_id) hard_stats_url
           , case when ec.id is null then 'u-vh' else '' end tbd_class
           , case 
               when s.rooms_open_flag = 'Y' and s.completed_ind = 'N' then 'Y'
             end tournament_inprogress
      from wmg_tournament_sessions_v s
         , wmg_courses ec
         , wmg_courses hc
      where s.easy_course_id = ec.id (+)
        and s.hard_course_id = hc.id (+)
        and s.tournament_session_id = :P60_TOURNAMENT_SESSION_ID
      
    page-items-to-submit: 
    - P60_TOURNAMENT_SESSION_ID

  layout: 
    sequence: 20
    parent-region: '{col2}' # 44899432802786407
    slot: SUB_REGIONS
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Alert
    template-options: 
    - '#DEFAULT#'
    - t-Alert--colorBG
    - t-Alert--horizontal
    - t-Alert--noIcon
    - t-Alert--info
    - t-Alert--accessibleHeading
    render-components: Below Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  server-cache: 
    caching: Disabled

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    layout: 
      number-of-rows-type: Static Value
      number-of-rows: 10

    appearance: 
      template-type: Theme
      template: Standard
      template-options: 
      - '#DEFAULT#'
      - t-Report--stretch
      - t-Report--staticRowColors
      - t-Report--rowHighlightOff
      - t-Report--noBorders

    pagination: 
      type: No Pagination (Show All Rows)
      partial-page-refresh: true

    performance: 
      lazy-loading: false

    messages: 
      when-no-data-found: |
        - The next tournament courses have not been selected yet -<br>
        Try again tomorrow...

    break-formatting: 
      break-columns: No Break

    advanced: 
      strip-html: false
      sort-nulls: Last

    heading: 
      type: None

    download: 
      csv-export-enabled: false

    printing: 
      enabled: false

  columns: 
  - # ====== Column: TOURNAMENT_INPROGRESS =======================
    id: 17397411794035168
    identification: 
      column-name: TOURNAMENT_INPROGRESS
      type: Hidden

    layout: 
      sequence: 130

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: EASY_RECORD =================================
    id: 44899554263786408
    identification: 
      column-name: EASY_RECORD
      type: Hidden

    layout: 
      sequence: 70

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: HARD_RECORD =================================
    id: 44899655346786409
    identification: 
      column-name: HARD_RECORD
      type: Hidden

    layout: 
      sequence: 100

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: SESSION_DATE ================================
    id: 46481837069463212
    identification: 
      column-name: SESSION_DATE
      type: Plain Text

    heading: 
      heading: Session Date
      alignment: center

    layout: 
      sequence: 20
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    appearance: 
      format-mask: fmDay, fmMonth fmDD, YYYY

    column-formatting: 
      html-expression: |
        <div class="row">
        <div class="col col-7 col-xs-12 col-sm-12 col-md-12">
          <b>Season: </b>&P60_TOURNAMENT.<br>
          <b>Week: </b>&P60_WEEK. - #SESSION_DATE#<br>
          <b>Players: </b>&P60_TOTAL_PLAYERS. <i>(Played/Signup)</i><br>
          <br>
        </div>
        <div class="col col-4 col-xs-12 col-sm-12 col-md-12 col-lg-12">
            {if TOURNAMENT_INPROGRESS/}
            <div class="u-danger margin-md padding-sm u-tC">In progress - Results not final
                <span aria-hidden="true" class="fa fa-spinner fa-anim-spin-step"></span>
            </div>
            {endif/}
        </div>
        </div>
        <div class="row nextCourses">
            <div class="col course easy">
                <a href="#EASY_STATS_URL#">
                    <div class="name">#EASY_COURSE_CODE# - #EASY_COURSE#</div>
                <div class="score #TBD_CLASS#">WMGT Record #EASY_RECORD#</div>
                <img class="courseIcon #TBD_CLASS#" src="&BUCKET.#EASY_COURSE_CODE#_FULL.jpg" loading="lazy">
                <div class="info #EASY_RECORD# #TBD_CLASS#">How hard is #EASY_COURSE_CODE#?</div>
                </a>
            </div>
            <div class="col course hard">
                <a href="#HARD_STATS_URL#">
                    <div class="name">#HARD_COURSE_CODE# - #HARD_COURSE#</div>
                <div class="score #TBD_CLASS#">WMGT Record #HARD_RECORD#</div>
                <img class="courseIcon #TBD_CLASS#" src="&BUCKET.#HARD_COURSE_CODE#_FULL.jpg" loading="lazy">
                <div class="info #HARD_RECORD# #TBD_CLASS#">How hard is #HARD_COURSE_CODE#?</div>
                </a>
            </div>
        </div>

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: EASY_COURSE_CODE ============================
    id: 46482296907463213
    identification: 
      column-name: EASY_COURSE_CODE
      type: Hidden

    layout: 
      sequence: 40

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: EASY_COURSE =================================
    id: 46482685513463214
    identification: 
      column-name: EASY_COURSE
      type: Hidden

    layout: 
      sequence: 60

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: EASY_STATS_URL ==============================
    id: 46483400562463215
    identification: 
      column-name: EASY_STATS_URL
      type: Hidden

    layout: 
      sequence: 80

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: HARD_COURSE_CODE ============================
    id: 46483898530463216
    identification: 
      column-name: HARD_COURSE_CODE
      type: Hidden

    layout: 
      sequence: 50

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: HARD_COURSE =================================
    id: 46484293343463216
    identification: 
      column-name: HARD_COURSE
      type: Hidden

    layout: 
      sequence: 90

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: HARD_STATS_URL ==============================
    id: 46485031785463218
    identification: 
      column-name: HARD_STATS_URL
      type: Hidden

    layout: 
      sequence: 110

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: TBD_CLASS ===================================
    id: 46485409535463218
    identification: 
      column-name: TBD_CLASS
      type: Hidden

    layout: 
      sequence: 120

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

- # ====== Region: Highlights ==================================
  id: 49360696889693070005
  identification: 
    name: Highlights
    type: Classic Report

  source: 
    location: Local Database
    type: SQL Query
    sql-query: |
      with session_stats as (
            select count(*) total_registered, sum(decode(pp.player_id, null, 0, 1)) total_played
              from wmg_tournament_players p
              left join wmg_tournament_session_points_v pp 
                on pp.tournament_session_id = p.tournament_session_id
                and pp.player_id = p.player_id
            where p.tournament_session_id = :P60_TOURNAMENT_SESSION_ID
               and p.active_ind = 'Y'
      )
      , players_with_aces as (
            select c.id course_id, tc.course_no, r.player_id
              from wmg_rounds_unpivot_mv r
                 , wmg_tournament_courses tc
                 , wmg_courses c
             where tc.course_id = r.course_id
               and r.course_id = c.id
               and r.week = :P60_WEEK
               and tc.tournament_session_id = :P60_TOURNAMENT_SESSION_ID
               and r.score = 1
      )
      select 100 + course_no display_seq, 'Best score ' || course_code result, listagg(player_name, ', ') who, total
      from (
            select r.*, rank() over (partition by course_no order by r.total) rn
            from (
            select tc.course_no, r.course_code, r.player_id, r.player_name, sum(r.under_par) total
              from wmg_rounds_v r
                 , wmg_tournament_courses tc
             where tc.tournament_session_id = r.tournament_session_id
               and tc.course_id = r.course_id
               and tc.tournament_session_id = :P60_TOURNAMENT_SESSION_ID
             group by tc.course_no, r.course_code, r.player_id, r.player_name
            ) r
            order by course_no, course_code, rn, r.player_name
      )
      where rn = 1
      group by course_no, course_code, total
      union all
      select 200 display_seq, result, listagg(who, ', ') who, total
      from (
          select result, who, total, rank() over (order by total desc) rn
          from (
          select '<i class="em em-gem" aria-role="presentation" aria-label="LARGE BLUE DIAMOND"></i> '
              || 'Player(s) with most Aces' result
               , r.player_name who
               , sum(decode(s1, 1, 1, 0)
                   + decode(s2, 1, 1, 0)
                   + decode(s3, 1, 1, 0)
                   + decode(s4, 1, 1, 0)
                   + decode(s5, 1, 1, 0)
                   + decode(s6, 1, 1, 0)
                   + decode(s7, 1, 1, 0)
                   + decode(s8, 1, 1, 0)
                   + decode(s9, 1, 1, 0)
                   + decode(s10, 1, 1, 0)
                   + decode(s11, 1, 1, 0)
                   + decode(s12, 1, 1, 0)
                   + decode(s13, 1, 1, 0)
                   + decode(s14, 1, 1, 0)
                   + decode(s15, 1, 1, 0)
                   + decode(s16, 1, 1, 0)
                   + decode(s17, 1, 1, 0)
                   + decode(s18, 1, 1, 0)
                ) total
            from wmg_rounds_v r
               , wmg_tournament_players tp
           where r.week = :P60_WEEK
            and r.tournament_session_id = tp.tournament_session_id
            and tp.player_id = r.player_id
            and tp.issue_code is null  -- only players with no issues are eligible
          group by r.player_name
          ) aces
          order by aces.who
      )
      where rn = 1
      and total > 0
      group by  result, total
      union all
      select 300 display_seq, '<i class="em em-coconut" aria-role="presentation" aria-label="em-coconut" title="Coconuts"></i> Coconuts' result, who, total
      from 
       (select c.total_coconuts || ' out of ' || st.total_played || ' players'
                       || case 
                          when nvl(st.total_played,0) = 0 then ''
                          else
                           ' (' || 100  * round(c.total_coconuts / st.total_played,2) || '%)'
                          end who   -- total  (total %)
              , c.total_coconuts total
              , case 
                  when nvl(st.total_played,0) = 0 then 1
                  else
                     c.total_coconuts / st.total_played
                end ratio
            from session_stats st
               , (select count(*) total_coconuts
                  from (
                      select u.week
                        from wmg_rounds_unpivot_mv u
                           , wmg_tournament_sessions ts
                           , wmg_tournament_players tp
                       where ts.week = u.week
                         and ts.id = tp.tournament_session_id
                         and u.week = :P60_WEEK
                         and tp.player_id = u.player_id
                         and tp.issue_code is null  -- only players with no issues are eligible
                         and tp.active_ind = 'Y'
                         -- and u.week = s.week
                       having sum(case when par <= 0 then 1 else 0 end) = 36
                       group by u.week, u.player_id
                  )
                 ) c
        ) coconut_players
       where ratio < .2 -- only display when the ration is less than 20%
      order by display_seq
      
    page-items-to-submit: 
    - P60_WEEK

  layout: 
    sequence: 30
    parent-region: '{About week &P60_WEEK.}' # 24790742868226858754
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Standard
    template-options: 
    - '#DEFAULT#'
    - t-Region--removeHeader js-removeLandmark
    - t-Region--noUI
    - t-Region--scrollBody
    - margin-top-lg
    - margin-left-md
    - margin-right-md
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  server-cache: 
    caching: Disabled

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    layout: 
      number-of-rows-type: Static Value
      number-of-rows: 15

    appearance: 
      template-type: Theme
      template: Standard
      template-options: 
      - '#DEFAULT#'
      - t-Report--stretch
      - t-Report--staticRowColors
      - t-Report--rowHighlightOff
      - t-Report--noBorders

    pagination: 
      type: No Pagination (Show All Rows)
      partial-page-refresh: true

    performance: 
      lazy-loading: false

    break-formatting: 
      break-columns: No Break

    advanced: 
      strip-html: false
      sort-nulls: Last

    heading: 
      type: Custom Headings

    download: 
      csv-export-enabled: false

    printing: 
      enabled: false

  columns: 
  - # ====== Column: DISPLAY_SEQ =================================
    id: 17395966059035153
    identification: 
      column-name: DISPLAY_SEQ
      type: Hidden

    layout: 
      sequence: 10

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: RESULT ======================================
    id: 46525810349481477
    identification: 
      column-name: RESULT
      type: Plain Text

    heading: 
      heading: Highlight
      alignment: center

    layout: 
      sequence: 20
      column-alignment: center

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: false

  - # ====== Column: WHO =========================================
    id: 46526272965481480
    identification: 
      column-name: WHO
      type: Plain Text

    heading: 
      heading: Who
      alignment: center

    layout: 
      sequence: 30
      column-alignment: center

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: TOTAL =======================================
    id: 46526501639481539
    identification: 
      column-name: TOTAL
      type: Plain Text

    heading: 
      heading: Total
      alignment: center

    layout: 
      sequence: 40
      column-alignment: center

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

- # ====== Region: {items} =====================================
  id: 106632178401810217449
  identification: 
    name: '{items}'
    type: Static Content

  layout: 
    sequence: 5
    parent-region: No Parent
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Blank with Attributes
    template-options: 
    - '#DEFAULT#'
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: itemsRegion
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: Week Results (&P60_WEEK.) ===================
  id: 108304671264572297709
  identification: 
    name: Week Results (&P60_WEEK.)
    type: Classic Report

  source: 
    location: Local Database
    type: SQL Query
    sql-query: |
      with coconut as (
          select u.week
               , u.player_id, sum(case when score is not null and par <= 0 then 1 else 0 end) under_par
            from wmg_rounds_unpivot_mv u
               , wmg_tournament_sessions ts
               , wmg_tournament_players tp
           where ts.week = u.week
             and ts.id = tp.tournament_session_id
             and tp.player_id = u.player_id
             and tp.issue_code is null  -- only players with no issues are eligible
             and u.week = :P60_WEEK
             and ts.completed_ind = 'N'  -- only live results
           having sum(case when par <= 0 then 1 else 0 end) = 36
           group by u.week, u.player_id
      )
      , cactus as (
           select player_id, count(*) n
            from (
            select u.course_id || ':' || u.h h, u.score, any_value(u.player_id) player_id
              from wmg_rounds_unpivot_mv u
                 , wmg_tournament_players tp
                 , wmg_tournament_sessions ts
             where ts.week = u.week
               and ts.id = tp.tournament_session_id
               and tp.player_id = u.player_id
               and tp.issue_code is null  -- only players with no issues are eligible
               and u.week = :P60_WEEK
               and ts.completed_ind = 'N' -- only live results
               and :P60_TOTAL_PLAYED >= 5 -- at least 5 players
               and u.score = 1
            having count(*) = 1
             group by u.course_id || ':' || u.h, u.score
           )
           group by player_id
      )
      , duck as (
           select player_id, count(*) n
            from (
                select u.course_id || ':' || u.h h, u.score, u.player_id player_id
                  from wmg_rounds_unpivot_mv u
                     , wmg_tournament_players tp
                     , wmg_tournament_sessions ts
                 where ts.week = u.week
                   and ts.id = tp.tournament_session_id
                   and tp.player_id = u.player_id
                   and tp.issue_code is null  -- only players with no issues are eligible
                   and u.week = :P60_WEEK
                   and ts.completed_ind = 'N' -- only live results
                   and :P60_TOTAL_PLAYED >= 10 -- at least 10 players
                   and u.score = 1
                   and (u.course_id, u.h) in (
                           select u2.course_id, u2.h
                              -- , count(*) possible_ducks
                              from  wmg_rounds_unpivot_mv u2
                              where u2.week = :P60_WEEK
                              and u2.score = 1 -- ace score
                              having count(*) between 2 and 2 
                              group by u2.course_id, u2.h
                   )
           )
           group by player_id
      )
      , diamond as (
        select u.player_id, count(*) aces
              from wmg_rounds_unpivot_mv u
                 , wmg_tournament_players tp
                 , wmg_tournament_sessions ts
             where ts.week = u.week
               and ts.id = tp.tournament_session_id
               and tp.player_id = u.player_id
               and tp.issue_code is null  -- only players with no issues are eligible
               and u.week = :P60_WEEK
               and ts.completed_ind = 'N' -- only live results
               and u.score = 1
             group by u.player_id
             having count(*) in (
                 select max(sum(u2.score)) aces
                  from  wmg_rounds_unpivot_mv u2
                  where u2.week = :P60_WEEK
                  and u2.score = 1
                  group by u2.player_id
             )
      )
      , beetle as (
           select u.player_id, count(*) n
             from wmg_rounds_unpivot_mv u
                 , wmg_tournament_players tp
                 , wmg_tournament_sessions ts
             where ts.week = u.week
               and ts.id = tp.tournament_session_id
               and tp.player_id = u.player_id
               and tp.issue_code is null  -- only players with no issues are eligible
               and u.week = :P60_WEEK
               and ts.completed_ind = 'N'  -- only live results
               and :P60_TOTAL_PLAYED >= 10 -- at least 10 players
               and (u.course_id, u.h, u.score) in (
                select u.course_id, u.h, u.score
                  from wmg_rounds_unpivot_mv u
                  where u.week = :P60_WEEK
                   and (u.course_id, u.h, u.score) in (
                       select u2.course_id, u2.h, min(u2.score) possible_beetles
                          from  wmg_rounds_unpivot_mv u2
                          where u2.week = :P60_WEEK
                          and u2.score > 1 -- non-ace score
                          group by u2.course_id, u2.h
                 )
                having count(*) <= 3
                 group by u.course_id, u.h, u.score
            )
           group by u.player_id
      )
      , badges as (
       select p.tournament_session_id, p.player_id
              -- need to expand by the badge_count, because people can habe multiple-badges
            , listagg( (select listagg(replace(b.icon_class, 'em em', 'em'), ' ') from dual connect by level <= p.badge_count) , ' ')  within group ( order by b.display_seq) other_badges
            , json_objectagg(key p.badge_type_code value case when p.badge_count>=1 then 'true' else 'false' end) badge_json
        from wmg_player_badges p
           , wmg_badge_types b
        where p.badge_type_code = b.code
          and p.tournament_session_id = :P60_TOURNAMENT_SESSION_ID
          and b.selectable_ind = 'Y'
        group by p.tournament_session_id, p.player_id
      )
      , unicorns as (
       select u.score_tournament_session_id tournament_session_id, u.player_id
              -- need to expand by the badge_count, because people can habe multiple-badges
            , listagg( replace(b.icon_class, 'em em', 'em'), ' ')  within group ( order by b.display_seq) unicorn_badges
        from wmg_player_unicorns u
           , wmg_badge_types b
        where u.score_tournament_session_id = :P60_TOURNAMENT_SESSION_ID
          and b.code = 'UNICORN'
        group by u.score_tournament_session_id, u.player_id
      )
      , me as (
          select nvl(max(player_id),-1) player_id, nvl(max(pos),0) pos
            from wmg_tournament_session_points_v
           where week = :P60_WEEK
             and player_id = :G_PLAYER_ID
      )
      select sp.pos
           , rank() over (partition by sp.rank_code order by sp.pos) rank_pos
           , tp.team_name
           , sp.player_id
           , wmg_discord.avatar_link(pp.discord_id, pp.discord_avatar) avatar
           , pp.country_code
           , pp.country
           , pp.account
           , pp.discord_id
           , pp.player_name
           , sp.easy
           , sp.hard
           , sp.easy_round_id, sp.hard_round_id
           , sp.total_score
           , coalesce(p.points, sp.points) points
           , case when sp.pos <= 10 then 'top' else 'p' || to_char(coalesce(p.points, sp.points)) end
           || case when coalesce(p.points, sp.points) <= 0 then ' missing tooltip' end
           || case when sp.pos <= 3 then ' podium podium' || sp.pos  end point_class
           , case when coalesce(p.points, sp.points) <= 0 then 'Failed to complete round, or failed to submit scores before deadline' end points_title
           , decode(p.player_id, :G_PLAYER_ID, 'mark', '') selected_player
           , case when sp.pos = 1 then '<i class="em em-trophy" aria-role="presentation" aria-label="TROPHY"></i>' else '' end trophy
           , pp.rank_code
           , pp.rank_name
           , pp.rank_list_class
           , case when sp.completed_ind = 'N' then
               case sp.pos 
               when 1 then 'em-first_place_medal '
               when 2 then 'em-second_place_medal '
               when 3 then 'em-third_place_medal '
               end
             end
          || decode(coconut.under_par, 36, 'em-coconut' || case when cactus.player_id is null and beetle.player_id is null and duck.player_id is null then '' else ' ' end, '') 
          || decode(cactus.player_id, null, null, (select listagg('em-cactus', ' ') from dual connect by level <= cactus.n) ) || decode(cactus.player_id, null, null, ' ')
          || decode(duck.player_id, null, null, (select listagg('em-duck', ' ') from dual connect by level <= duck.n) ) || decode(beetle.player_id, null, null, ' ')
          || decode(beetle.player_id, null, null, (select listagg('em-beetle', ' ') from dual connect by level <= beetle.n) ) 
          || decode(diamond.player_id, null, '', ' ') || decode(diamond.player_id, null, null, 'em-gem')
          || ' ' || badges.other_badges || ' ' || unicorns.unicorn_badges badges
           , nvl(badges.badge_json, '{}') badge_json
           , apex_page.get_url(p_page => '65', p_items => 'P65_TOURNAMENT_SESSION_ID,P65_PLAYER_ID', p_values=> sp.tournament_session_id || ','||sp.player_id) edit_badges_link
      --     , apex_util.prepare_url('f?=' || :APP_ID || ':65:' || :APP_SESSION || ':::P65_TOURNAMENT_SESSION_ID,P65_PLAYER_ID,'|| p.tournament_session_id || ','||p.player_id) edit_badges_link
           , '' badges_menu
           , i.icon issue_icon
           , i.description issue_description
           , p.issue_code
      from wmg_tournament_session_points_v sp
      , wmg_tournament_players p
      , wmg_team_players_v tp
      , wmg_issues i
      , wmg_players_v pp
      , coconut
      , cactus
      , duck
      , badges
      , diamond
      , beetle
      , unicorns
      , me
      where sp.week = :P60_WEEK
        and sp.player_id = pp.id
        and sp.tournament_id = tp.tournament_id(+)
        and sp.player_id = tp.player_id(+)
        and sp.player_id = p.player_id (+)
        and sp.player_id = coconut.player_id (+)
        and sp.player_id = cactus.player_id (+)
        and sp.player_id = duck.player_id (+)
        and sp.player_id = diamond.player_id (+)
        and sp.player_id = beetle.player_id (+)
        and sp.player_id = badges.player_id (+)
        and sp.player_id = unicorns.player_id (+)
        and sp.tournament_session_id = p.tournament_session_id (+)
        and p.issue_code = i.code (+)
        and (:P60_ONLY_ME_IND = 'N' 
          or (me.player_id = -1 or (sp.pos between greatest((me.pos - 2),1) and (me.pos + 3)))
        )
      order by coalesce(p.points, sp.points) desc, sp.pos, nls_upper(sp.player_name)
      
    page-items-to-submit: 
    - P60_WEEK
    - P60_TOTAL_PLAYED
    - P60_TOURNAMENT_SESSION_ID
    - P60_ONLY_ME_IND
    optimizer-hint: WITH_PLSQL

  layout: 
    sequence: 20
    parent-region: '{col1}' # 36324460593635102
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Standard
    template-options: 
    - '#DEFAULT#'
    - t-Region--noPadding
    - js-showMaximizeButton
    - t-Region--scrollBody
    - margin-left-none
    - margin-right-none
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: weekResults
    region-display-selector: false
    exclude-title-from-translation: false

  header-and-footer: 
    header-text: '"RANK_LEGEND_SEARCH"'

  server-cache: 
    caching: Disabled

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    layout: 
      number-of-rows-type: Static Value
      number-of-rows: 250

    appearance: 
      template-type: Theme
      template: Standard
      template-options: 
      - '#DEFAULT#'
      - t-Report--stretch
      - t-Report--staticRowColors
      - t-Report--rowHighlightOff
      - t-Report--verticalBorders
      - t-Report--hideNoPagination

    pagination: 
      type: Row Ranges X to Y of Z (no pagination)
      display-position: Bottom - Right
      partial-page-refresh: true

    performance: 
      lazy-loading: false

    messages: 
      when-no-data-found: '- No scores yet -'

    break-formatting: 
      break-columns: No Break

    advanced: 
      strip-html: false
      sort-nulls: Last

    heading: 
      type: Custom Headings

    download: 
      csv-export-enabled: false

    printing: 
      enabled: false

  columns: 
  - # ====== Column: COUNTRY_CODE ================================
    id: 9131754515384814
    identification: 
      column-name: COUNTRY_CODE
      type: Hidden

    layout: 
      sequence: 40

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: RANK_POS ====================================
    id: 9134653353384843
    identification: 
      column-name: RANK_POS
      type: Plain Text

    heading: 
      heading: 'Rank #'
      alignment: center

    layout: 
      sequence: 20
      column-alignment: center

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: SELECTED_PLAYER =============================
    id: 12528418345550021
    identification: 
      column-name: SELECTED_PLAYER
      type: Hidden

    layout: 
      sequence: 150

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: TROPHY ======================================
    id: 16730222845921829
    identification: 
      column-name: TROPHY
      type: Hidden

    layout: 
      sequence: 160

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: false

  - # ====== Column: ACCOUNT =====================================
    id: 32959011995648014
    identification: 
      column-name: ACCOUNT
      type: Hidden

    layout: 
      sequence: 72

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: DISCORD_ID ==================================
    id: 32959117583648015
    identification: 
      column-name: DISCORD_ID
      type: Hidden

    layout: 
      sequence: 74

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: ISSUE_CODE ==================================
    id: 36052635355175837
    identification: 
      column-name: ISSUE_CODE
      type: Hidden

    layout: 
      sequence: 240

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: BADGES ======================================
    id: 36324511178635103
    identification: 
      column-name: BADGES
      type: Plain Text

    heading: 
      heading: Badges
      alignment: center

    layout: 
      sequence: 170
      column-alignment: center

    accessibility: 
      value-identifies-row: false

    column-formatting: 
      html-expression: |
        {loop " " BADGES/}
        <i class="badge em &APEX$ITEM." aria-role="presentation" aria-label="&APEX$ITEM." title=""></i>
        {endloop/}
        {if ISSUE_CODE/}
        <i class="tooltip #ISSUE_ICON#" aria-role="presentation" aria-label="#ISSUE_CODE#" title="#ISSUE_DESCRIPTION#"></i>
        {endif/}

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: BADGES_MENU =================================
    id: 36324871727635106
    identification: 
      column-name: BADGES_MENU
      type: Plain Text

    heading: 
      heading: Add Badges
      alignment: center

    layout: 
      sequence: 180
      column-alignment: center

    accessibility: 
      value-identifies-row: false

    column-formatting: 
      html-expression: |
        <button type="button" class="t-Button t-Button--icon t-Button--noLabel t-Button--tiny t-Button--stretch js-menuButton" data-menu="badge_list_menu" aria-label="Badges" title="Badges" data-id="#PLAYER_ID#" data-title="Badges" aria-haspopup="menu" 
        data-link="#EDIT_BADGES_LINK#" 
        data-issue="#ISSUE_CODE#"
        data-badges=#BADGE_JSON#>
        <span aria-hidden="true" class="fa fa-badges"></span>
        <span aria-hidden="true" class="fa fa-chevron-down"></span>
        </button>
        

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      authorization-scheme: Contribution Rights # 46995203801871514425
      escape-special-characters: false

  - # ====== Column: BADGE_JSON ==================================
    id: 36325120269635109
    identification: 
      column-name: BADGE_JSON
      type: Hidden

    layout: 
      sequence: 190

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: EASY_ROUND_ID ===============================
    id: 39069562829021512
    identification: 
      column-name: EASY_ROUND_ID
      type: Hidden

    layout: 
      sequence: 250

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: HARD_ROUND_ID ===============================
    id: 39069672182021513
    identification: 
      column-name: HARD_ROUND_ID
      type: Hidden

    layout: 
      sequence: 260

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: ISSUE_ICON ==================================
    id: 39070684775021523
    identification: 
      column-name: ISSUE_ICON
      type: Hidden

    layout: 
      sequence: 270

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: ISSUE_DESCRIPTION ===========================
    id: 39070737765021524
    identification: 
      column-name: ISSUE_DESCRIPTION
      type: Hidden

    layout: 
      sequence: 280

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: EDIT_BADGES_LINK ============================
    id: 41137852955776027
    identification: 
      column-name: EDIT_BADGES_LINK
      type: Hidden

    layout: 
      sequence: 200

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: RANK_NAME ===================================
    id: 41139945029776048
    identification: 
      column-name: RANK_NAME
      type: Hidden

    layout: 
      sequence: 220

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: RANK_LIST_CLASS =============================
    id: 41140040258776049
    identification: 
      column-name: RANK_LIST_CLASS
      type: Hidden

    layout: 
      sequence: 230

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: TEAM_NAME ===================================
    id: 43143970411406742
    identification: 
      column-name: TEAM_NAME
      type: Plain Text

    heading: 
      heading: Team
      alignment: center

    layout: 
      sequence: 35
      column-alignment: center

    accessibility: 
      value-identifies-row: false

    column-formatting: 
      html-expression: |
        {if TEAM_NAME/}
        <div class="cgabadge tooltip" title="Team #TEAM_NAME#">
        <span class="u-vh">CGA</span>
        </div>
        {else/}
        <span class="u-vh cgabadge"></span>
        {endif/}

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: AVATAR ======================================
    id: 47966709657877950
    identification: 
      column-name: AVATAR
      type: Plain Text

    heading: 
      heading: Avatar
      alignment: center

    layout: 
      sequence: 60
      column-alignment: center

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    server-side-condition: 
      type: User is Authenticated (not public)

    security: 
      escape-special-characters: false

  - # ====== Column: COUNTRY =====================================
    id: 48533849608964201
    identification: 
      column-name: COUNTRY
      type: Plain Text

    heading: 
      heading: <span aria-hidden="true" class="fa fa-flag-o"></span>
      alignment: center

    layout: 
      sequence: 50
      column-alignment: center

    accessibility: 
      value-identifies-row: false

    column-formatting: 
      html-expression: '<i class="em em-flag-#COUNTRY_CODE# tooltip" aria-role="presentation" aria-label="Flag #COUNTRY_CODE#" title="#COUNTRY#"></i>'

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: RANK_CODE ===================================
    id: 49530580415520826
    identification: 
      column-name: RANK_CODE
      type: Hidden

    layout: 
      sequence: 210

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: POINTS_TITLE ================================
    id: 55136786209510007
    identification: 
      column-name: POINTS_TITLE
      type: Hidden

    layout: 
      sequence: 140

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: POINT_CLASS =================================
    id: 2325273901416905573
    identification: 
      column-name: POINT_CLASS
      type: Hidden

    layout: 
      sequence: 130

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: EASY ========================================
    id: 56024167382698751673
    identification: 
      column-name: EASY
      type: Link

    heading: 
      heading: '&P60_EASY.'
      alignment: center

    layout: 
      sequence: 80
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    link: 
      target: 
        url: 'f?p=&APP_ID.:10:&SESSION.:COMPARE:&DEBUG.:10:P10_ROUND_ID:#EASY_ROUND_ID#'
        page: 10 # Player Round Details
        request: COMPARE
        clear-cache: 10
        values: 
          p10_round_id: '#EASY_ROUND_ID#'

      link-text: '#EASY#'

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: HARD ========================================
    id: 56024167489932751674
    identification: 
      column-name: HARD
      type: Link

    heading: 
      heading: '&P60_HARD.'
      alignment: center

    layout: 
      sequence: 90
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    link: 
      target: 
        url: 'f?p=&APP_ID.:10:&SESSION.:COMPARE:&DEBUG.:10:P10_ROUND_ID:#HARD_ROUND_ID#'
        page: 10 # Player Round Details
        request: COMPARE
        clear-cache: 10
        values: 
          p10_round_id: '#HARD_ROUND_ID#'

      link-text: '#HARD#'

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: POINTS ======================================
    id: 56024167767542751677
    identification: 
      column-name: POINTS
      type: Plain Text

    heading: 
      heading: Points
      alignment: center

    layout: 
      sequence: 110
      column-alignment: center

    accessibility: 
      value-identifies-row: false

    column-formatting: 
      html-expression: '<span class="points #POINT_CLASS#" title="#POINTS_TITLE#">#POINTS#</span>'

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: TOTAL_SCORE =================================
    id: 58999021903683521116
    identification: 
      column-name: TOTAL_SCORE
      type: Plain Text

    heading: 
      heading: Total
      alignment: center

    layout: 
      sequence: 100
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: PLAYER_NAME =================================
    id: 58999022291973521117
    identification: 
      column-name: PLAYER_NAME
      type: Link

    heading: 
      heading: Player
      alignment: center

    layout: 
      sequence: 70
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    link: 
      target: 
        url: 'f?p=&APP_ID.:110:&SESSION.::&DEBUG.:110:P110_WEEK,P110_PLAYER_ID:&P60_WEEK.,#PLAYER_ID#'
        page: 110 # Player Round Details
        clear-cache: 110
        values: 
          p110_week: '&P60_WEEK.'
          p110_player_id: '#PLAYER_ID#'

      link-text: '<div class="-wm-player-name">#PLAYER_NAME#<span class="u-vh">#DISCORD_ID# #ACCOUNT#</span></div> <div class="w #RANK_LIST_CLASS# tooltip" title="#RANK_NAME#"></div><div class="w">#TROPHY#</div>'

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: POS =========================================
    id: 58999022657537521117
    identification: 
      column-name: POS
      type: Plain Text

    heading: 
      heading: '<span class="searchLabel">Overall</span> #'
      alignment: center

    layout: 
      sequence: 30
      column-alignment: center

    accessibility: 
      value-identifies-row: false

    column-formatting: 
      html-expression: |
        <span class="#SELECTED_PLAYER#">#POS#</span>
        <span class="u-vh rank">#RANK_CODE#</span>

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: PLAYER_ID ===================================
    id: 58999023114457521117
    identification: 
      column-name: PLAYER_ID
      type: Link

    heading: 
      heading: Edit
      alignment: center

    layout: 
      sequence: 10
      column-alignment: center

    accessibility: 
      value-identifies-row: false

    link: 
      target: 
        url: 'f?p=&APP_ID.:7:&SESSION.::&DEBUG.:7:P7_ID:#PLAYER_ID#'
        page: 7 # Player
        clear-cache: 7
        values: 
          p7_id: '#PLAYER_ID#'

      link-text: '&EDIT_BUTTON.'

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      authorization-scheme: Tournament Admin # 55902033226819493948
      escape-special-characters: true

- # ====== Region: Other Results ===============================
  id: 108304672202837297718
  identification: 
    name: Other Results
    type: Static Content

  layout: 
    sequence: 55
    parent-region: No Parent
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Standard
    template-options: 
    - '#DEFAULT#'
    - t-Region--noPadding
    - t-Region--scrollBody
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: true
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

page-items: 
- # ====== Page Item: P60_TOTAL_PLAYED =========================
  id: 8054926482938713
  identification: 
    name: P60_TOTAL_PLAYED
    type: Hidden

  settings: 
    value-protected: true

  layout: 
    sequence: 160
    region: '{items}' # 106632178401810217449
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P60_TOTAL_WEEKS ==========================
  id: 12088827004682766
  identification: 
    name: P60_TOTAL_WEEKS
    type: Hidden

  settings: 
    value-protected: true

  layout: 
    sequence: 10
    region: Most h1n Over the last &P60_TOTAL_WEEKS. weeks # 24462990776443619028
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P60_TOURNAMENT ===========================
  id: 16128586339878819
  identification: 
    name: P60_TOURNAMENT
    type: Hidden

  settings: 
    value-protected: true

  layout: 
    sequence: 90
    region: '{items}' # 106632178401810217449
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P60_TOURNAMENT_ID ========================
  id: 16731343202921840
  identification: 
    name: P60_TOURNAMENT_ID
    type: Hidden

  settings: 
    value-protected: true

  layout: 
    sequence: 100
    region: '{items}' # 106632178401810217449
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P60_TOURNAMENT_SESSION_ID ================
  id: 36324927914635107
  identification: 
    name: P60_TOURNAMENT_SESSION_ID
    type: Hidden

  settings: 
    value-protected: true

  layout: 
    sequence: 110
    region: '{items}' # 106632178401810217449
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P60_BADGE_ID =============================
  id: 36326869674635126
  identification: 
    name: P60_BADGE_ID
    type: Hidden

  settings: 
    value-protected: false

  layout: 
    sequence: 120
    region: '{items}' # 106632178401810217449
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P60_SEARCH ===============================
  id: 36327487092635132
  identification: 
    name: P60_SEARCH
    type: Text Field

  label: 
    label: Player
    alignment: Left

  settings: 
    subtype: Search
    trim-spaces: Leading and Trailing
    text-case: NO CHANGE
    submit-when-enter-pressed: false
    disabled: false

  layout: 
    sequence: 30
    region: '{items}' # 106632178401810217449
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default
    column-css-classes: 
    - col-xxs-5
    - col-md-4
    - col-sm-5
    - col-lg-3

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    icon: fa-search
    width: 30

  validation: 
    value-required: false

  advanced: 
    post-text-: '"CLEAR_BUTTON"'
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P60_ONLY_ME_IND ==========================
  id: 36327955646635137
  identification: 
    name: P60_ONLY_ME_IND
    type: Switch

  label: 
    label: Find Me?
    alignment: Left

  settings: 
    use-defaults: true

  layout: 
    sequence: 40
    region: '{items}' # 106632178401810217449
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: 1
    label-column-span: Page Template Default
    column-css-classes: 
    - hidden-xs-down

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  validation: 
    value-required: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: N

  session-state: 
    storage: Per Session (Persistent)

  server-side-condition: 
    type: Item is NOT NULL
    item: G_PLAYER_ID

  security: 
    authorization-scheme: MODEL.LOV.MUST_NOT_BE_PUBLIC_USER
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P60_NAV_DIRECTION ========================
  id: 37924571840930005
  identification: 
    name: P60_NAV_DIRECTION
    type: Hidden

  settings: 
    value-protected: false

  layout: 
    sequence: 130
    region: '{items}' # 106632178401810217449
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P60_NAV_PREV =============================
  id: 37924688683930006
  identification: 
    name: P60_NAV_PREV
    type: Hidden

  settings: 
    value-protected: false

  layout: 
    sequence: 140
    region: '{items}' # 106632178401810217449
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: show

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P60_NAV_NEXT =============================
  id: 37924725010930007
  identification: 
    name: P60_NAV_NEXT
    type: Hidden

  settings: 
    value-protected: false

  layout: 
    sequence: 150
    region: '{items}' # 106632178401810217449
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P60_SELECTOR =============================
  id: 47966416840877947
  identification: 
    name: P60_SELECTOR
    type: Radio Group

  label: 
    label: View
    alignment: Left

  settings: 
    number-of-columns: 3
    page-action-on-selection: Redirect and Set Value

  layout: 
    sequence: 5
    region: '{items}' # 106632178401810217449
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: 3
    label-column-span: Page Template Default
    column-css-classes: 
    - col-xxs-12
    - col-xs-12
    - col-sm-12

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    - t-Form-fieldContainer--stretchInputs
    - t-Form-fieldContainer--radioButtonGroup

  validation: 
    value-required: false

  list-of-values: 
    type: Static Values
    static-values: 'STATIC2:Week;WEEK,Season;SEASON,Top Finishes;TOP'
    display-extra-values: true
    display-null-value: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: WEEK

  session-state: 
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: false
    escape-special-characters: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P60_WEEK =================================
  id: 58999001935862516160
  identification: 
    name: P60_WEEK
    type: Popup LOV

  label: 
    label: Week
    alignment: Left

  settings: 
    display-as: Inline Popup
    initial-fetch: Automatic
    manual-entry: false
    search-as-you-type: true
    minimum-characters: No minimum (0)

  multiple-values: 
    type: No

  layout: 
    sequence: 10
    region: '{items}' # 106632178401810217449
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: 3
    label-column-span: Page Template Default
    column-css-classes: 
    - col-xxs-5
    - col-xs-4
    - col-sm-4
    - col-md-4
    - col-lg-4

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    css-classes: 
    - '&P60_NAV_PREV.'
    - '&P60_NAV_NEXT.'
    width: 30

  validation: 
    value-required: false

  list-of-values: 
    type: Shared Component
    list-of-values: WEEKS # 41203762596358122145
    display-extra-values: true
    display-null-value: true

  advanced: 
    pre-text: |
      <button class="t-Button t-Button--noLabel t-Button--icon t-Button--iconOnly t-Button--noUI week_nav_btn hidden-xxs-down" aria-expanded="false" aria-controls="weekNav" type="button" title="Prev Week" aria-label="Prev Week" data-nav="prev">
      <span class="t-Icon fa fa-chevron-left" aria-hidden="true"></span>
      </button>
      
    post-text-: |
      <button class="t-Button t-Button--noLabel t-Button--icon t-Button--iconOnly t-Button--noUI week_nav_btn hidden-xxs-down" aria-expanded="false" aria-controls="weekNav" type="button" title="Next Week" aria-label="Prev Week" data-nav="next">
      <span class="t-Icon fa fa-chevron-right" aria-hidden="true"></span>
      </button>
      
    warn-on-unsaved-changes: Page Default
    initialization-javascript-function: wmgt.theme.weekLovTemplate

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P60_TOTAL_PLAYERS ========================
  id: 58999002369755516160
  identification: 
    name: P60_TOTAL_PLAYERS
    type: Display Only

  label: 
    label: Total Players
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: true

  layout: 
    sequence: 20
    region: '{items}' # 106632178401810217449
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: 2
    label-column-span: Page Template Default
    column-css-classes: 
    - col-xxs-2
    - col-xs-3
    - col-sm-3
    - col-md-1
    - col-lg-2

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    css-classes: 
    - u-textCenter

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: SQL Query (return single value)
    sql-query: |
      select nvl2(players, players || '/', '') || total players
      from (
      select count(*) total, sum(decode(pp.player_id, null, 0, 1)) players
        from wmg_tournament_players p
        left join wmg_tournament_session_points_v pp 
          on pp.tournament_session_id = p.tournament_session_id
          and pp.player_id = p.player_id
       where p.tournament_session_id = :P60_TOURNAMENT_SESSION_ID
         and p.active_ind = 'Y'
       )
    used: Always, replacing any existing value in session state

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  server-side-condition: 
    type: Item is NOT NULL
    item: P60_WEEK

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P60_H ====================================
  id: 58999002735707516160
  identification: 
    name: P60_H
    type: Hidden

  settings: 
    value-protected: false

  layout: 
    sequence: 50
    region: '{items}' # 106632178401810217449
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P60_EASY =================================
  id: 58999003526641516161
  identification: 
    name: P60_EASY
    type: Hidden

  settings: 
    value-protected: true

  layout: 
    sequence: 70
    region: '{items}' # 106632178401810217449
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: SQL Query (return single value)
    sql-query: |
      select c.code
          from wmg_courses_v c
             , wmg_tournament_courses tc
         where c.course_id = tc.course_id
           and tc.tournament_session_id = :P60_TOURNAMENT_SESSION_ID
           and course_no = 1
    used: Always, replacing any existing value in session state

  default: 
    type: Static
    static-value: Easy Course

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P60_HARD =================================
  id: 58999003979871516161
  identification: 
    name: P60_HARD
    type: Hidden

  settings: 
    value-protected: true

  layout: 
    sequence: 80
    region: '{items}' # 106632178401810217449
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: SQL Query (return single value)
    sql-query: |
      select c.code
          from wmg_courses_v c
             , wmg_tournament_courses tc
         where c.course_id = tc.course_id
           and tc.tournament_session_id = :P60_TOURNAMENT_SESSION_ID
           and course_no = 2
    used: Always, replacing any existing value in session state

  default: 
    type: Static
    static-value: Hard Course

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

buttons: 
- # ====== Button: ABOUT =======================================
  id: 8727957840818333
  identification: 
    button-name: ABOUT
    label: About the points

  layout: 
    sequence: 10
    region: Week Results (&P60_WEEK.) # 108304671264572297709
    slot: EDIT
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    button-template: Text with Icon
    hot: false
    template-options: 
    - '#DEFAULT#'
    - t-Button--mobileHideLabel
    - t-Button--iconRight
    icon: fa-question-circle-o

  behavior: 
    action: Redirect to Page in this Application
    target: 
      url: 'f?p=&APP_ID.:20:&SESSION.::&DEBUG.:20:P20_NOTE_TYPE:POINTS'
      page: 20 # About/Rules
      clear-cache: 20
      values: 
        p20_note_type: POINTS

    warn-on-unsaved-changes: Do Not Check

- # ====== Button: VERIFY_RESULTS ==============================
  id: 9190426324315450
  identification: 
    button-name: VERIFY_RESULTS
    label: Verify Results

  layout: 
    sequence: 40
    region: Breadcrumb Bar (Contrubutor) # 8056243674938726
    slot: NEXT
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    button-template: Text with Icon
    hot: false
    template-options: 
    - '#DEFAULT#'
    - t-Button--mobileHideLabel
    - t-Button--small
    - t-Button--simple
    - t-Button--iconLeft
    css-classes: 
    - col-xss-3
    - col-xs-3
    icon: fa-window-check

  behavior: 
    action: Redirect to Page in this Application
    target: 
      url: 'f?p=&APP_ID.:75:&SESSION.::&DEBUG.:75:P75_WEEK:&P60_WEEK.'
      page: 75 # Verify Results
      clear-cache: 75
      values: 
        p75_week: '&P60_WEEK.'

    warn-on-unsaved-changes: Do Not Check

  security: 
    authorization-scheme: Contribution Rights # 46995203801871514425

- # ====== Button: COURSES_ROUNDUP =============================
  id: 32461521264429413
  identification: 
    button-name: COURSES_ROUNDUP
    label: Courses Roundup

  layout: 
    sequence: 10
    region: '{About week &P60_WEEK.}' # 24790742868226858754
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: 10
    new-column: true
    column-span: Automatic
    alignment: Right

  appearance: 
    button-template: Text with Icon
    hot: false
    template-options: 
    - '#DEFAULT#'
    - t-Button--iconLeft
    icon: fa-compass

  behavior: 
    action: Redirect to Page in this Application
    target: 
      url: 'f?p=&APP_ID.:64:&SESSION.::&DEBUG.:64:P64_TOURNAMENT_SESSION_ID:&P60_TOURNAMENT_SESSION_ID.'
      page: 64 # Courses Roundup
      clear-cache: 64
      values: 
        p64_tournament_session_id: '&P60_TOURNAMENT_SESSION_ID.'

    warn-on-unsaved-changes: Do Not Check

  security: 
    authorization-scheme: Contribution Rights # 46995203801871514425

- # ====== Button: DOWNLOAD ====================================
  id: 24450902434343936260
  identification: 
    button-name: DOWNLOAD
    label: Download Detailed Results

  layout: 
    sequence: 30
    region: Breadcrumb Bar (Contrubutor) # 8056243674938726
    slot: NEXT
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    button-template: Text with Icon
    hot: false
    template-options: 
    - '#DEFAULT#'
    - t-Button--mobileHideLabel
    - t-Button--small
    - t-Button--simple
    - t-Button--iconLeft
    css-classes: 
    - col-xss-3
    - col-xs-3
    icon: fa-download-alt

  behavior: 
    action: Redirect to Page in this Application
    target: 
      url: 'f?p=&APP_ID.:62:&SESSION.::&DEBUG.:62:P62_WEEK:&P60_WEEK.'
      page: 62 # Results Download
      clear-cache: 62
      values: 
        p62_week: '&P60_WEEK.'

    warn-on-unsaved-changes: Do Not Check

  security: 
    authorization-scheme: Contribution Rights # 46995203801871514425

dynamic-actions: 
- # ====== Dynamic Action: Highlight Player ====================
  id: 12528683820550023
  identification: 
    name: Highlight Player

  execution: 
    sequence: 40
    event-scope: Static
    type: Immediate

  when: 
    event: After Refresh
    selection-type: Region
    region: Week Results (&P60_WEEK.) # 108304671264572297709

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 12528755733550024
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        $(".mark").parents("tr").addClass("mark");
        wmgt.theme.init(); // tooltips

    execution: 
      sequence: 10
      event: Highlight Player # 12528683820550023
      fire-when-event-result-is: True
      fire-on-initialization: true

  - # ====== Action: Badge Tooltips ==============================
    id: 49532640205520847
    identification: 
      name: Badge Tooltips
      action: Execute JavaScript Code

    settings: 
      code: |
        $('.badge').tooltip({
          content: $('#badgeKey').html(), // Set tooltip content to contents of #badgeKey table
          track: true, // Enable mouse tracking to keep tooltip open while hovering over it
          delay: 500 // Set delay to half a second (500 milliseconds)
        });

    execution: 
      sequence: 20
      event: Highlight Player # 12528683820550023
      fire-when-event-result-is: True
      fire-on-initialization: true

- # ====== Dynamic Action: Celebrate with Confetti =============
  id: 20605983648883943
  identification: 
    name: Celebrate with Confetti

  execution: 
    sequence: 120
    event-scope: Static

  when: 
    event: Page Load

  server-side-condition: 
    type: Request = Value
    value: SUCCESS

  comments: 
    comments: |
      New condition to celebrate the top 10:
      select 1
      from wmg_tournament_session_points_v
      where week = :P50_WEEK
        and player_id = :P50_PLAYERS_ID
        and points <= 10

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 20606349410883951
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: confetti_time()

    execution: 
      sequence: 10
      event: Celebrate with Confetti # 20605983648883943
      fire-when-event-result-is: True
      fire-on-initialization: false

    client-side-condition: 
      type: JavaScript expression
      javascript-expression: '!apex.theme.mq("(prefers-reduced-motion)")'

- # ====== Dynamic Action: Search as we type ===================
  id: 36327504110635133
  identification: 
    name: Search as we type

  execution: 
    sequence: 50
    event-scope: Static
    type: Immediate

  when: 
    event: Key Release
    selection-type: Item(s)
    item(s): 
    - P60_SEARCH

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 36327667959635134
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        // Highlight the search term using markjs.io (and even filter away the non-matching lines)
        // var $ctx=$("#report_table_weekResults .t-Report-cell[headers='PLAYER_NAME']")
        var $ctx=$("#report_table_weekResults .t-Report-cell[headers='PLAYER_NAME'], #report_table_weekResults2 .t-Report-cell[headers='PLAYER_NAME']")
          , $other=$("#badgeKey,.pro-legend")
          , term=$v("P60_SEARCH");
        
        
        // Remove previous marked elements and ensure they all show
        $ctx.unmark().parents("tr").show();
        if (apex.theme.mq("(max-width: 768px)")) {
          $other.show();
        }
        
        if (term) {
          // mark the search term and hide everything that didn't get marked
          $ctx.mark(term, {
            separateWordSearch: false,
            caseSensitive: false,
            acrossElements: true,
            diacritics: true,
            done: function() {
        
              $ctx.not(":has(mark)").parents("tr").hide();
              if ($ctx.find("mark").length > 0 && apex.theme.mq("(max-width: 768px)")) {
                 // if something is found and we're on a small device, hide the other regions
                 $other.hide();
               }
            }
          });
        }
        
        

    execution: 
      sequence: 10
      event: Search as we type # 36327504110635133
      fire-when-event-result-is: True
      fire-on-initialization: true

- # ====== Dynamic Action: Only Me Refresh =====================
  id: 36328005385635138
  identification: 
    name: Only Me Refresh

  execution: 
    sequence: 60
    event-scope: Static
    type: Immediate

  when: 
    event: Change
    selection-type: Item(s)
    item(s): 
    - P60_ONLY_ME_IND

  actions: 
  - # ====== Action: Refresh =====================================
    id: 36328199344635139
    identification: 
      action: Refresh

    affected-elements: 
      selection-type: Region
      region: Week Results (&P60_WEEK.) # 108304671264572297709

    execution: 
      sequence: 10
      event: Only Me Refresh # 36328005385635138
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Clear on Change =====================
  id: 36328927765635147
  identification: 
    name: Clear on Change

  execution: 
    sequence: 70
    event-scope: Static
    type: Immediate

  when: 
    event: Change
    selection-type: Item(s)
    item(s): 
    - P60_SEARCH

  client-side-condition: 
    type: Item is null
    item: P60_SEARCH

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 36329053597635148
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        var $ctx=$("#report_table_weekResults .t-Report-cell[headers='PLAYER_NAME']")
          , $other=$("#badgeKey,.pro-legend");
        
        
        // Remove previous marked elements and ensure they all show
        $ctx.unmark().parents("tr").show();
        if (apex.theme.mq("(max-width: 768px)")) {
          $other.show();
        }
        

    execution: 
      sequence: 10
      event: Clear on Change # 36328927765635147
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Next & Prev Week Navigation =========
  id: 37924213762930002
  identification: 
    name: Next & Prev Week Navigation

  execution: 
    sequence: 80
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: jQuery Selector
    jquery-selector: .week_nav_btn

  actions: 
  - # ====== Action: Set Value ===================================
    id: 37924397204930003
    identification: 
      action: Set Value

    settings: 
      set-type: SQL Statement
      sql-statement: |
        select decode(:P60_NAV_DIRECTION, 'next', next_week, prev_week)
        from (
        select lag(week) over (partition by tournament_id order by round_num) prev_week
             , id, round_num, week
             , lead(week) over (partition by tournament_id order by round_num) next_week
        from wmg_tournament_sessions
        )
        where week = :P60_WEEK
      items-to-submit: 
      - P60_WEEK
      - ' P60_NAV_DIRECTION'
      escape-special-characters: false
      suppress-change-event: false

    affected-elements: 
      selection-type: Item(s)
      item(s): 
      - P60_WEEK

    execution: 
      sequence: 20
      event: Next & Prev Week Navigation # 37924213762930002
      fire-when-event-result-is: True
      fire-on-initialization: false
      stop-execution-on-error: true
      wait-for-result: true

  - # ====== Action: Set Value ===================================
    id: 37924432108930004
    identification: 
      action: Set Value

    settings: 
      set-type: JavaScript Expression
      javascript-expression: this.triggeringElement.dataset.nav
      suppress-change-event: false

    affected-elements: 
      selection-type: Item(s)
      item(s): 
      - P60_NAV_DIRECTION

    execution: 
      sequence: 10
      event: Next & Prev Week Navigation # 37924213762930002
      fire-when-event-result-is: True
      fire-on-initialization: false
      stop-execution-on-error: true
      wait-for-result: true

- # ====== Dynamic Action: Sticky Items ========================
  id: 38803596533452998
  identification: 
    name: Sticky Items

  execution: 
    sequence: 90
    event-scope: Static

  when: 
    event: Page Load

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 38803903658453014
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        var vRegion$ = $(this.affectedElements[0]);
        vRegion$.stickyWidget();
        // .find('.js-stickyTableHeader')

    affected-elements: 
      selection-type: Region
      region: '{items}' # 106632178401810217449

    execution: 
      sequence: 10
      event: Sticky Items # 38803596533452998
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Refresh on Close ====================
  id: 41138341573776032
  identification: 
    name: Refresh on Close

  execution: 
    sequence: 100
    event-scope: Static
    type: Immediate

  when: 
    event: Dialog Closed or Canceled
    selection-type: Region
    region: Week Results (&P60_WEEK.) # 108304671264572297709

  security: 
    authorization-scheme: Contribution Rights # 46995203801871514425

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 39069799926021514
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: console.log(this.data);

    execution: 
      sequence: 10
      event: Refresh on Close # 41138341573776032
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Refresh =====================================
    id: 41138419360776033
    identification: 
      action: Refresh

    affected-elements: 
      selection-type: Region
      region: Week Results (&P60_WEEK.) # 108304671264572297709

    execution: 
      sequence: 20
      event: Refresh on Close # 41138341573776032
      fire-when-event-result-is: True
      fire-on-initialization: false

    client-side-condition: 
      type: JavaScript expression
      javascript-expression: this.data.dialogPageId != 10

- # ====== Dynamic Action: Rank & Team Selectors ===============
  id: 49530602545520827
  identification: 
    name: Rank & Team Selectors

  execution: 
    sequence: 110
    event-scope: Static
    type: Immediate

  when: 
    event: Change
    selection-type: jQuery Selector
    jquery-selector: .wm-search

  actions: 
  - # ====== Action: Get Selected Value ==========================
    id: 49530771871520828
    identification: 
      name: Get Selected Value
      action: Execute JavaScript Code

    settings: 
      code: |
        selectedRank = this.triggeringElement.value
        selectedRankClass = $(this.triggeringElement).parents(".wm-search-item").find("div").attr("class").split(" ")[0]; // get the class
        
        if (selectedRank === "ALL") {
          selectedRank = ""
          selectedRankClass = ""
          $("#weekResults").removeClass("search-on").removeClass("cga");
        }
        $("#weekResults").removeClass("cga");
        

    execution: 
      sequence: 10
      event: Rank & Team Selectors # 49530602545520827
      fire-when-event-result-is: True
      fire-on-initialization: false

    client-side-condition: 
      type: JavaScript expression
      javascript-expression: this.triggeringElement.checked

  - # ====== Action: Execute JavaScript Code =====================
    id: 49530813689520829
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        // Highlight the search term using markjs.io (and even filter away the non-matching lines)
        // var $ctx=$("#report_table_weekResults .t-Report-cell[headers='PLAYER_NAME']")
        var $ctx;
        
        if (selectedRank==="CGA") {
          $ctx = $("#report_table_weekResults .t-Report-cell[headers='TEAM_NAME'] .cgabadge");
        }
        else {
          $ctx = $("#report_table_weekResults .t-Report-cell[headers='POS'] .rank");
        }
        
        // Remove previous marked elements and ensure they all show
        $ctx.unmark().parents("tr").show();
        
        if (selectedRank) {
          // mark the search selectedRank and hide everything that didn't get marked
          $ctx.mark(selectedRank, {
            done: function() {
              $ctx.not(":has(mark)").parents("tr").hide();
              $("#weekResults").addClass("search-on");
              if (selectedRank==="CGA") {
                $("#weekResults").addClass("cga");
                // $("#weekResults").find("#TEAM_NAME").html('<div class="' + selectedRankClass + ' tooltip" title="CGA Team Memebers"></div');
              }
              else {
                $("#weekResults").find("#RANK_POS").html('<div class="fa ' + selectedRankClass + '"></div><div>Rank #</div>');
              }
            }
          });
        }
        
        

    execution: 
      sequence: 30
      event: Rank & Team Selectors # 49530602545520827
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Clear Selected Value ========================
    id: 49530976437520830
    identification: 
      name: Clear Selected Value
      action: Execute JavaScript Code

    settings: 
      code: selectedRank = ""

    execution: 
      sequence: 20
      event: Rank & Team Selectors # 49530602545520827
      fire-when-event-result-is: True
      fire-on-initialization: false

    client-side-condition: 
      type: JavaScript expression
      javascript-expression: '!this.triggeringElement.checked'

- # ====== Dynamic Action: Hoist Classes to TD =================
  id: 2325273968654905574
  identification: 
    name: Hoist Classes to TD

  execution: 
    sequence: 10
    event-scope: Static
    type: Immediate

  when: 
    event: After Refresh
    selection-type: Region
    region: Week Results (&P60_WEEK.) # 108304671264572297709

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 2325274036724905575
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        $("td .points").each(
          function(){
            var $el = $(this),
                c = $el.attr("class");
        
            $el.parent("td").addClass(c);
          }
        );
        
        $("td .podium").each(
          function(){
            var $el = $(this);
            c = $el.attr("class");
        
            $el.parents("tr").addClass(c);
          }
        )

    execution: 
      sequence: 10
      event: Hoist Classes to TD # 2325273968654905574
      fire-when-event-result-is: True
      fire-on-initialization: true

- # ====== Dynamic Action: Reload on Change ====================
  id: 40389413760926769175
  identification: 
    name: Reload on Change

  execution: 
    sequence: 30
    event-scope: Static
    type: Immediate

  when: 
    event: Change
    selection-type: Item(s)
    item(s): 
    - P60_WEEK

  actions: 
  - # ====== Action: Submit Page =================================
    id: 40389413906808769176
    identification: 
      action: Submit Page

    settings: 
      request-/-button-name: REFRESH
      show-processing: true

    execution: 
      sequence: 10
      event: Reload on Change # 40389413760926769175
      fire-when-event-result-is: True
      fire-on-initialization: false

computations: 
- # ====== Computation: P60_TOTAL_WEEKS ========================
  id: 11993270819685627
  identification: 
    item-name: P60_TOTAL_WEEKS

  execution: 
    sequence: 10
    point: Before Regions

  computation: 
    type: SQL Query (return single value)
    sql-query: |
      select count(*)
      from  wmg_tournament_sessions
      

processes: 
- # ====== Process: Init =======================================
  id: 12528395706550020
  identification: 
    name: Init
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      begin
       if :P60_WEEK is null then
      
          with prev_ts as (
              select id tournament_session_id, week
              from wmg_tournament_sessions
              where (tournament_id, round_num) in (
                  select s.tournament_id, s.round_num - 1
                  from wmg_tournament_sessions s
                  where s.id = :G_CURRENT_SESSION_ID
              )
              union -- get the current week as a a backup
              select tournament_session_id, week
              from (
              select id tournament_session_id, week
                from wmg_tournament_sessions
               where id = decode(:G_CURRENT_SESSION_ID, null, id, -1, id, :G_CURRENT_SESSION_ID)
               order by session_date desc
               fetch first 1 rows only
              )
              order by week desc
              fetch first 1 rows only
          )
          select decode(ts.rooms_open_flag, 'Y', ts.week, prev_ts.week) week
               , decode(ts.rooms_open_flag, 'Y', ts.id, prev_ts.tournament_session_id) 
            into :P60_WEEK
               , :P60_TOURNAMENT_SESSION_ID
            from wmg_tournament_sessions ts
            left join prev_ts on 1=1
           where ts.id = prev_ts.tournament_session_id;
      
      --     where ts.id = :G_CURRENT_SESSION_ID;
      
       end if;
      
           select tournament_session_id
                , tournament_id
                , prefix_tournament
            into :P60_TOURNAMENT_SESSION_ID
               , :P60_TOURNAMENT_ID
               , :P60_TOURNAMENT
            from wmg_tournament_sessions_v
           where week = :P60_WEEK;
      
          select nvl(players,0)
               , nvl2(players, players || '/', '') || total players
            into :P60_TOTAL_PLAYED, :P60_TOTAL_PLAYERS
          from (
          select count(*) total, sum(decode(pp.player_id, null, 0, 1)) players
            from wmg_tournament_players p
            left join wmg_tournament_session_points_v pp 
              on pp.tournament_session_id = p.tournament_session_id
              and pp.player_id = p.player_id
           where p.tournament_session_id = :P60_TOURNAMENT_SESSION_ID
             and p.active_ind = 'Y'
           );
      
           select decode(prev_week, null, 'hide_nav_pre') NAV_PREV
                , decode(next_week, null, 'hide_nav_next') NAV_NEXT
             into :P60_NAV_PREV
                , :P60_NAV_NEXT
              from (
              select lag(week) over (partition by tournament_id order by round_num) prev_week
                   , id, round_num, week
                   , lead(week) over (partition by tournament_id order by round_num) next_week
              from wmg_tournament_sessions
              )
              where week = :P60_WEEK;
      
      exception
      when NO_DATA_FOUND then
       logger.log('.. no data found', 'p60.init');
      
       null;
      end;
      
      

  execution: 
    sequence: 10
    point: Before Header
    run-process: Once Per Page Visit (default)

- # ====== Process: BADGES =====================================
  id: 36325009752635108
  identification: 
    name: BADGES
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      declare
        l_badge_rec wmg_player_badges%rowtype;
        l_inc number;
        l_return varchar2(10);
      begin
        l_badge_rec.player_id := to_number(apex_application.g_x02);
        l_badge_rec.badge_type_code := apex_application.g_x03;
        l_badge_rec.tournament_session_id := :P60_TOURNAMENT_SESSION_ID;
      
        if apex_application.g_x01 = 'Add' then
          l_inc := 1;
          l_badge_rec.badge_count := 1;
          l_return := 'ADDED';
        else
          l_inc := -1;
          l_badge_rec.badge_count := 0;
          l_return := 'REMOVED';
        end if;
      
        update wmg_player_badges
           set badge_count = case when l_inc = -1 then least(0, badge_count + l_inc) else badge_count + l_inc end
         where player_id = l_badge_rec.player_id
           and badge_type_code = l_badge_rec.badge_type_code
           and tournament_session_id = l_badge_rec.tournament_session_id
           returning id into l_badge_rec.id;
      
          if SQL%ROWCOUNT = 0 then
            insert into wmg_player_badges(
                player_id
              , badge_type_code
              , tournament_session_id
              , badge_count
            )
            values (
                l_badge_rec.player_id
              , l_badge_rec.badge_type_code
              , l_badge_rec.tournament_session_id
              , l_badge_rec.badge_count
            )
            returning id into l_badge_rec.id;
      
          end if;
      
          apex_json.open_object; -- {
            apex_json.write('status', l_return);
            if l_return = 'ADDED' then
              apex_json.write('id', l_badge_rec.id);
              apex_json.write('badge', apex_application.g_x03);
            end if;
          apex_json.close_object; -- }
      
      end;
      
      

  execution: 
    sequence: 10
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

  security: 
    authorization-scheme: Contribution Rights # 46995203801871514425

branches: 
- # ====== Branch: View Season =================================
  id: 47966673281877949
  identification: 
    name: View Season

  execution: 
    sequence: 10
    point: Before Header

  behavior: 
    type: Page or URL (Redirect)
    target: 
      url: 'f?p=&APP_ID.:61:&SESSION.:&REQUEST.:&DEBUG.::P61_SELECTOR,P61_WEEK:&P60_SELECTOR.,&P60_WEEK.&success_msg=#SUCCESS_MSG#'
      page: 61 # View Season Results
      request: '&REQUEST.'
      values: 
        p61_selector: '&P60_SELECTOR.'
        p61_week: '&P60_WEEK.'

  server-side-condition: 
    type: Item = Value
    item: P60_SELECTOR
    value: SEASON

- # ====== Branch: View Top ====================================
  id: 49941485723933559
  identification: 
    name: View Top

  execution: 
    sequence: 30
    point: Before Header

  behavior: 
    type: Page or URL (Redirect)
    target: 
      url: 'f?p=&APP_ID.:63:&SESSION.::&DEBUG.::P63_SELECTOR,P63_WEEK:&P60_SELECTOR.,&P60_WEEK.&success_msg=#SUCCESS_MSG#'
      page: 63 # Season Results: Top Finishes
      values: 
        p63_selector: '&P60_SELECTOR.'
        p63_week: '&P60_WEEK.'

  server-side-condition: 
    type: Item = Value
    item: P60_SELECTOR
    value: TOP

